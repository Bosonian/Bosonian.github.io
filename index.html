<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GFAP Risk Calculator</title>
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#007bff">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { font-family: 'Arial', sans-serif; text-align: center; background-color: #ffffff; margin: 0; padding: 20px; }
        .container { max-width: 600px; margin: 20px auto; padding: 20px; background-color: white; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        input, button { width: 90%; padding: 12px; margin: 8px 0; border-radius: 5px; font-size: 16px; }
        button.primary { background-color: #007bff; color: white; border: none; }
        button.secondary { background-color: #6c757d; color: white; border: none; }
        .result { padding: 15px; margin: 20px 0; border-radius: 8px; display: none; }
        .low-risk { background-color: #d4edda; color: #155724; }
        .medium-risk { background-color: #fff3cd; color: #856404; }
        .high-risk { background-color: #f8d7da; color: #721c24; }
        .stroke-warning { background-color: #e2e3e5; color: #383d41; border: 2px solid #007bff; }
        .hidden { display: none; }
        .age-group { margin: 15px 0; }
        .fas { margin-right: 8px; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Language Selector -->
        <div style="margin-bottom: 20px;">
            <button onclick="switchLanguage('de')" class="secondary">ðŸ‡©ðŸ‡ª Deutsch</button>
            <button onclick="switchLanguage('en')" class="secondary">ðŸ‡¬ðŸ‡§ English</button>
        </div>

        <!-- Access Control -->
        <div id="accessSection">
            <h2><i class="fas fa-lock"></i><span id="title">GFAP Risk Calculator</span></h2>
            <input type="password" id="accessCode" placeholder="Enter access code">
            <button class="primary" onclick="validateAccess()"><i class="fas fa-check"></i>Continue</button>
            <p id="accessError" class="hidden" style="color: red;"></p>
        </div>

        <!-- Module Selection -->
        <div id="moduleSection" class="hidden">
            <h3><span id="moduleTitle">Select Analysis Module</span></h3>
            <button class="primary" onclick="selectModule('coma')"><i class="fas fa-bed"></i>Coma Analysis</button>
            <button class="primary" onclick="selectModule('stroke')"><i class="fas fa-brain"></i>Stroke Analysis</button>
        </div>

        <!-- Coma Module -->
        <div id="comaSection" class="hidden">
            <div class="input-group">
                <input type="number" id="comaGFAP" placeholder="GFAP value (pg/mL)" min="29" max="100001">
            </div>
            <button class="primary" onclick="calculateComa()"><i class="fas fa-calculator"></i>Calculate</button>
        </div>

        <!-- Stroke Module -->
        <div id="strokeSection" class="hidden">
            <div class="age-group">
                <input type="number" id="patientAge" placeholder="Patient age (1-101)" min="1" max="101">
            </div>
            <div class="input-group">
                <input type="number" id="strokeGFAP" placeholder="GFAP value (pg/mL)" min="0" max="100001">
            </div>
            <div id="fastEdGroup" class="hidden">
                <input type="number" id="fastEdScore" placeholder="FAST-ED Score (0-6)" min="0" max="6">
            </div>
            <button class="primary" onclick="calculateStroke()"><i class="fas fa-calculator"></i>Calculate</button>
        </div>

        <!-- Results Display -->
        <div id="resultSection" class="result hidden">
            <h4><i class="fas fa-poll"></i><span id="resultTitle">Analysis Result</span></h4>
            <div id="resultContent"></div>
        </div>
    </div>

    <script>
        const ACCESS_CODES = ["0P9MYVVA","U68M94MV","J8RKB4Z5","SKZUSTQ1","F5IJOOVY","VVXTWAKB"];
        let currentLang = 'en';
        let currentModule = '';

        const translations = {
            en: {
                accessError: "Invalid access code!",
                comaResult: (p) => `Coma Risk: ${p}% probability of intracranial bleeding`,
                strokeResults: {
                    low: "High probability of ischemic stroke",
                    lvo: "If FAST-ED â‰¥4: High probability of LVO",
                    thresholds: {
                        '<72': { mid: "85%", high: "91%" },
                        '72-83': { mid: "83%", high: "90%" },
                        '>83': { mid: "82%", high: "82%" }
                    }
                }
            },
            de: {
                accessError: "UngÃ¼ltiger Zugangscode!",
                comaResult: (p) => `Koma-Risiko: ${p}% Wahrscheinlichkeit fÃ¼r intrakranielle Blutung`,
                strokeResults: {
                    low: "Hohe Wahrscheinlichkeit fÃ¼r Hirninfarkt",
                    lvo: "Bei FAST-ED â‰¥4: Hohe Wahrscheinlichkeit fÃ¼r LVO",
                    thresholds: {
                        '<72': { mid: "85%", high: "91%" },
                        '72-83': { mid: "83%", high: "90%" },
                        '>83': { mid: "82%", high: "82%" }
                    }
                }
            }
        };

        // Core functionality
        function validateAccess() {
            const code = document.getElementById('accessCode').value.trim().toUpperCase();
            if(ACCESS_CODES.includes(code)) {
                document.getElementById('accessSection').classList.add('hidden');
                document.getElementById('moduleSection').classList.remove('hidden');
            } else {
                showError('accessError', translations[currentLang].accessError);
            }
        }

        function selectModule(module) {
            currentModule = module;
            document.getElementById('moduleSection').classList.add('hidden');
            document.getElementById(`${module}Section`).classList.remove('hidden');
            if(module === 'stroke') setupStrokeModule();
        }

        function setupStrokeModule() {
            document.getElementById('fastEdGroup').classList.add('hidden');
            document.getElementById('strokeGFAP').addEventListener('input', function(e) {
                document.getElementById('fastEdGroup').classList.toggle('hidden', e.target.value >= 30);
            });
        }

        function calculateComa() {
            const gfap = parseFloat(document.getElementById('comaGFAP').value);
            const probability = Math.min(Math.max((36.72 * Math.log10(gfap)) - 50.48, 0), 100);
            showResult(translations[currentLang].comaResult(probability.toFixed(1)), 
                     getRiskClass(probability));
        }

        function calculateStroke() {
            const age = parseInt(document.getElementById('patientAge').value);
            const gfap = parseFloat(document.getElementById('strokeGFAP').value);
            const fastEd = parseInt(document.getElementById('fastEdScore').value) || 0;
            
            let resultText = '';
            if(gfap < 30) {
                resultText = translations[currentLang].strokeResults.low;
                if(fastEd >= 4) resultText += `<br>${translations[currentLang].strokeResults.lvo}`;
                showResult(resultText, 'stroke-warning');
                return;
            }

            const ageGroup = age < 72 ? '<72' : age <= 83 ? '72-83' : '>83';
            const thresholds = translations[currentLang].strokeResults.thresholds[ageGroup];
            const riskValue = gfap >= 36.8 ? (gfap > thresholds.high ? thresholds.high : thresholds.mid) : '-';
            
            resultText = `Stroke Risk: ${riskValue} probability`;
            showResult(resultText, riskValue === '-' ? 'low-risk' : getRiskClass(riskValue));
        }

        // Helper functions
        function getRiskClass(value) {
            if(typeof value === 'number') {
                if(value < 33) return 'low-risk';
                if(value < 66) return 'medium-risk';
                return 'high-risk';
            }
            return value.includes('85') || value.includes('83') ? 'medium-risk' : 'high-risk';
        }

        function showResult(text, cssClass) {
            const resultDiv = document.getElementById('resultSection');
            resultDiv.className = `result ${cssClass}`;
            document.getElementById('resultContent').innerHTML = text;
            resultDiv.classList.remove('hidden');
        }

        function switchLanguage(lang) {
            currentLang = lang;
            // Update all text elements (implement based on your needs)
        }

        // Initialize
        document.getElementById('accessCode').focus();
    </script>
</body>
</html>