// This complete JavaScript code should be placed inside the <script> tags at the end of your HTML file

let currentLang = 'en';
let currentSection = 'codeEntry';

// Language translations
const translations = {
    en: {
        appTitle: "GFAP Risk App",
        codePromptTitle: "Access Required",
        codePrompt: "üîë Please enter your access code:",
        accessInfo: "This application is for healthcare professionals only.",
        submitText: "Submit",
        moduleSelectionTitle: "Select Module",
        moduleSelectionInfo: "Please select the appropriate module based on the patient's condition:",
        comaButtonText: "Coma / Bleeding Risk (GCS 3-8)",
        strokeButtonText: "Stroke Risk Calculator",
        disclaimerText: "This tool is designed to assist clinical decision-making and should not replace professional medical judgment.",
        strokePrerequisiteTitle: "Prerequisites for Stroke Risk Calculation",
        prerequisiteInfo: "Please confirm that all of the following criteria are met:",
        accessError: "Incorrect code. Please try again.",
        comaRiskTitle: "Coma / Bleeding Risk Calculator",
        comaInfo: "Enter the GFAP value to calculate the bleeding risk for a comatose patient (GCS 3-8).",
        strokeRiskTitle: "Stroke Risk Calculator",
        strokeInfo: "Enter the patient's age and GFAP value to calculate stroke risk.",
        calculateButton: "Calculate Risk",
        calculateComaText: "Calculate Risk",
        calculateStrokeText: "Calculate Risk",
        proceedText: "Proceed to Calculation",
        invalidInput: "Please enter a valid value!",
        lowRisk: "Low Risk",
        mediumRisk: "Medium Risk",
        highRisk: "High Risk",
        veryHighRisk: "Very High Risk",
        prerequisite1: "Confirmed time window < 6 hours",
        prerequisite2: "No neurological deficits in the hours/days before the event",
        prerequisite3: "No identifiable head trauma (severe fall)",
        prerequisite4: "FAST ED Score >= 3 points",
        prerequisiteError: "Please confirm all prerequisites before proceeding.",
        backText: "Back",
        backPrereqText: "Back",
        backStrokeText: "Back",
        homeText: "Home",
        methodManualLabel: "Manual Entry",
        methodIStatLabel: "i-STAT Device",
        strokeMethodManualLabel: "Manual Entry",
        strokeMethodIStatLabel: "i-STAT Device",
        gfapTooltip: "GFAP (Glial Fibrillary Acidic Protein) is a biomarker for brain injury.",
        strokeGfapTooltip: "GFAP (Glial Fibrillary Acidic Protein) is a biomarker for brain injury.",
        fastEdTooltip: "FAST ED: Face drooping (0-1), Arm weakness (0-2), Speech changes (0-2), Time (documentation), Eye deviation (0-2), Denial/neglect (0-2)",
        rightsText: "All rights reserved.",
        versionText: "Version 2.1",
        supportLink: "Support",
        detailsText: "Show Details",
        hideDetailsText: "Hide Details",
        recommendation: "Recommendation",
        probabilityText: "Probability",
        riskLevelText: "Risk Level"
    },
    de: {
        appTitle: "GFAP Risiko App",
        codePromptTitle: "Zugang erforderlich",
        codePrompt: "üîë Bitte geben Sie Ihren Zugangscode ein:",
        accessInfo: "Diese Anwendung ist nur f√ºr medizinisches Fachpersonal bestimmt.",
        submitText: "Best√§tigen",
        moduleSelectionTitle: "Modul ausw√§hlen",
        moduleSelectionInfo: "Bitte w√§hlen Sie das entsprechende Modul basierend auf dem Zustand des Patienten:",
        comaButtonText: "Koma / Blutungsrisiko (GCS 3-8)",
        strokeButtonText: "Schlaganfallrisikorechner",
        disclaimerText: "Dieses Tool soll die klinische Entscheidungsfindung unterst√ºtzen und ersetzt nicht die professionelle medizinische Beurteilung.",
        strokePrerequisiteTitle: "Voraussetzungen f√ºr die Schlaganfallrisikoberechnung",
        prerequisiteInfo: "Bitte best√§tigen Sie, dass alle folgenden Kriterien erf√ºllt sind:",
        accessError: "Falscher Code. Bitte versuchen Sie es erneut.",
        comaRiskTitle: "Koma / Blutungsrisiko Rechner",
        comaInfo: "Geben Sie den GFAP-Wert ein, um das Blutungsrisiko f√ºr einen komat√∂sen Patienten (GCS 3-8) zu berechnen.",
        strokeRiskTitle: "Schlaganfallrisiko Rechner",
        strokeInfo: "Geben Sie das Alter des Patienten und den GFAP-Wert ein, um das Schlaganfallrisiko zu berechnen.",
        calculateButton: "Risiko berechnen",
        calculateComaText: "Risiko berechnen",
        calculateStrokeText: "Risiko berechnen",
        proceedText: "Zur Berechnung fortfahren",
        invalidInput: "Bitte geben Sie einen g√ºltigen Wert ein!",
        lowRisk: "Geringes Risiko",
        mediumRisk: "Mittleres Risiko",
        highRisk: "Hohes Risiko",
        veryHighRisk: "Sehr hohes Risiko",
        prerequisite1: "Gesichertes Zeitfenster < 6 Stunden",
        prerequisite2: "Keine neurologische Defizite in den Stunden / Tagen vor dem Ereignis",
        prerequisite3: "Kein erkennbares Sch√§del Hirn Trauma (schwerer Sturz)",
        prerequisite4: "FAST ED Score >= 3 Punkte",
        prerequisiteError: "Bitte best√§tigen Sie alle Voraussetzungen, um fortzufahren.",
        backText: "Zur√ºck",
        backPrereqText: "Zur√ºck",
        backStrokeText: "Zur√ºck",
        homeText: "Start",
        methodManualLabel: "Manuelle Eingabe",
        methodIStatLabel: "i-STAT Ger√§t",
        strokeMethodManualLabel: "Manuelle Eingabe",
        strokeMethodIStatLabel: "i-STAT Ger√§t",
        gfapTooltip: "GFAP (Gliales fibrill√§res saures Protein) ist ein Biomarker f√ºr Hirnverletzungen.",
        strokeGfapTooltip: "GFAP (Gliales fibrill√§res saures Protein) ist ein Biomarker f√ºr Hirnverletzungen.",
        fastEdTooltip: "FAST ED: Gesichtsl√§hmung (0-1), Armschw√§che (0-2), Sprachst√∂rungen (0-2), Zeit (Dokumentation), Augenabweichung (0-2), Neglect (0-2)",
        rightsText: "Alle Rechte vorbehalten.",
        versionText: "Version 2.1",
        supportLink: "Support",
        detailsText: "Details anzeigen",
        hideDetailsText: "Details ausblenden",
        recommendation: "Empfehlung",
        probabilityText: "Wahrscheinlichkeit",
        riskLevelText: "Risikolevel"
    }
};

// Stroke risk interpretations
const strokeInterpretations = {
    en: {
        veryLow: "High probability of cerebral infarction. If FAST ED ‚â• 4, high probability of Large Vessel Occlusion (LVO).",
        low: "Ischemic stroke very likely.",
        intermediate: "Intermediate ICH risk.",
        high: "ICH risk high ~ 85%.",
        veryHigh: "ICH risk very high ~ 91%."
    },
    de: {
        veryLow: "Hohe Wahrscheinlichkeit f√ºr Hirninfarkt. Bei FAST ED ‚â• 4, hohe Wahrscheinlichkeit f√ºr Large Vessel Occlusion (LVO).",
        low: "Isch√§mischer Schlaganfall sehr wahrscheinlich.",
        intermediate: "Intermedi√§res ICH Risiko.",
        high: "ICH Risiko hoch ~ 85%.",
        veryHigh: "ICH Risiko sehr hoch ~ 91%."
    }
};

// Recommendations based on risk level
const recommendations = {
    en: {
        lowRisk: "Continue with standard stroke protocol. Consider transport to primary stroke center if symptoms support ischemic stroke diagnosis.",
        mediumRisk: "Consider early neurosurgical consultation. Transport to comprehensive stroke center if available within reasonable distance.",
        highRisk: "Urgent neurosurgical consultation recommended. Prioritize transport to comprehensive stroke center with neurosurgical capabilities.",
        veryHighRisk: "Immediate neurosurgical consultation required. Transport directly to nearest comprehensive stroke center with neurosurgical capabilities."
    },
    de: {
        lowRisk: "Fahren Sie mit dem Standardschlaganfallprotokoll fort. Erw√§gen Sie den Transport zu einem prim√§ren Schlaganfallzentrum, wenn die Symptome die Diagnose eines isch√§mischen Schlaganfalls st√ºtzen.",
        mediumRisk: "Erw√§gen Sie eine fr√ºhzeitige neurochirurgische Konsultation. Transport zu einem umfassenden Schlaganfallzentrum, wenn innerhalb angemessener Entfernung verf√ºgbar.",
        highRisk: "Dringende neurochirurgische Konsultation empfohlen. Priorisieren Sie den Transport zu einem umfassenden Schlaganfallzentrum mit neurochirurgischen Kapazit√§ten.",
        veryHighRisk: "Sofortige neurochirurgische Konsultation erforderlich. Transport direkt zum n√§chsten umfassenden Schlaganfallzentrum mit neurochirurgischen Kapazit√§ten."
    }
};

// Switch language function with UI update
function switchLanguage(lang) {
    currentLang = lang;
    
    // Update active language button
    document.getElementById('langEn').classList.remove('active');
    document.getElementById('langDe').classList.remove('active');
    document.getElementById('lang' + lang.charAt(0).toUpperCase() + lang.slice(1)).classList.add('active');
    
    const texts = translations[lang];
    
    // Update UI text elements
    document.getElementById('appTitle').innerText = texts.appTitle;
    document.getElementById('codePromptTitle').innerText = texts.codePromptTitle;
    document.getElementById('codePrompt').innerText = texts.codePrompt;
    document.getElementById('accessInfo').innerText = texts.accessInfo;
    document.getElementById('submitText').innerText = texts.submitText;
    document.getElementById('moduleSelectionTitle').innerText = texts.moduleSelectionTitle;
    document.getElementById('moduleSelectionInfo').innerText = texts.moduleSelectionInfo;
    document.getElementById('comaButtonText').innerText = texts.comaButtonText;
    document.getElementById('strokeButtonText').innerText = texts.strokeButtonText;
    document.getElementById('disclaimerText').innerText = texts.disclaimerText;
    document.getElementById('strokePrerequisiteTitle').innerText = texts.strokePrerequisiteTitle;
    document.getElementById('prerequisiteInfo').innerText = texts.prerequisiteInfo;
    document.getElementById('comaModuleTitle').innerText = texts.comaRiskTitle;
    document.getElementById('comaInfo').innerText = texts.comaInfo;
    document.getElementById('strokeModuleTitle').innerText = texts.strokeRiskTitle;
    document.getElementById('strokeInfo').innerText = texts.strokeInfo;
    document.getElementById('calculateComaText').innerText = texts.calculateButton;
    document.getElementById('calculateStrokeText').innerText = texts.calculateButton;
    document.getElementById('proceedText').innerText = texts.proceedText;
    document.getElementById('accessError').innerText = texts.accessError;
    document.getElementById('prerequisite1Label').innerText = texts.prerequisite1;
    document.getElementById('prerequisite2Label').innerText = texts.prerequisite2;
    document.getElementById('prerequisite3Label').innerText = texts.prerequisite3;
    document.getElementById('prerequisite4Label').innerText = texts.prerequisite4;
    document.getElementById('prerequisiteError').innerText = texts.prerequisiteError;
    document.getElementById('backText').innerText = texts.backText;
    document.getElementById('backPrereqText').innerText = texts.backPrereqText;
    document.getElementById('backStrokeText').innerText = texts.backStrokeText;
    document.getElementById('homeText').innerText = texts.homeText;
    document.getElementById('methodManualLabel').innerText = texts.methodManualLabel;
    document.getElementById('methodIStatLabel').innerText = texts.methodIStatLabel;
    document.getElementById('strokeMethodManualLabel').innerText = texts.strokeMethodManualLabel;
    document.getElementById('strokeMethodIStatLabel').innerText = texts.strokeMethodIStatLabel;
    document.getElementById('gfapTooltip').innerText = texts.gfapTooltip;
    document.getElementById('strokeGfapTooltip').innerText = texts.strokeGfapTooltip;
    document.getElementById('fastEdTooltip').innerText = texts.fastEdTooltip;
    document.getElementById('rightsText').innerText = texts.rightsText;
    document.getElementById('versionText').innerText = texts.versionText;
    document.getElementById('supportLink').innerText = texts.supportLink;
    
    // Update any visible results
    updateVisibleResults();
}

// Update visible results when language changes
function updateVisibleResults() {
    if (document.getElementById('comaResult').style.display === 'block') {
        calculateComaRisk(true);
    }
    if (document.getElementById('strokeResult').style.display === 'block') {
        calculateStrokeRisk(true);
    }
}

// Navigation functions
function restartApp() {
    hideAllSections();
    document.getElementById('moduleSelectionSection').style.display = 'block';
    currentSection = 'moduleSelection';
    resetFormInputs();
}

function goBack(module) {
    if (module === 'coma') {
        hideAllSections();
        document.getElementById('moduleSelectionSection').style.display = 'block';
        currentSection = 'moduleSelection';
    } else if (module === 'prereq') {
        hideAllSections();
        document.getElementById('moduleSelectionSection').style.display = 'block';
        currentSection = 'moduleSelection';
    } else if (module === 'stroke') {
        hideAllSections();
        document.getElementById('strokePrerequisiteSection').style.display = 'block';
        currentSection = 'strokePrerequisite';
    }
}

function hideAllSections() {
    document.getElementById('codeEntrySection').style.display = 'none';
    document.getElementById('moduleSelectionSection').style.display = 'none';
    document.getElementById('comaModuleSection').style.display = 'none';
    document.getElementById('strokePrerequisiteSection').style.display = 'none';
    document.getElementById('strokeModuleSection').style.display = 'none';
}

function resetFormInputs() {
    // Reset all input fields
    document.getElementById('accessCodeInput').value = '';
    document.getElementById('gfapComaInput').value = '';
    document.getElementById('ageInput').value = '';
    document.getElementById('gfapStrokeInput').value = '';
    
    // Reset checkboxes
    document.getElementById('prerequisite1').checked = false;
    document.getElementById('prerequisite2').checked = false;
    document.getElementById('prerequisite3').checked = false;
    document.getElementById('prerequisite4').checked = false;
    
    // Reset radio buttons
    document.getElementById('method-manual').checked = true;
    document.getElementById('stroke-method-manual').checked = true;
    
    // Hide any error messages
    document.getElementById('accessError').style.display = 'none';
    document.getElementById('prerequisiteError').style.display = 'none';
    
    // Hide results
    document.getElementById('comaResult').style.display = 'none';
    document.getElementById('strokeResult').style.display = 'none';
}

// Validate access code
function validateAccessCode() {
    const accessCode = document.getElementById('accessCodeInput').value.trim();
    const errorElement = document.getElementById('accessError');
    const validCodes = ['1234', 'stroke2025', 'medic'];
    
    // Show spinner
    document.getElementById('accessCodeInput').disabled = true;
    simulateLoading(function() {
        document.getElementById('accessCodeInput').disabled = false;
        
        if (validCodes.includes(accessCode)) {
            hideAllSections();
            document.getElementById('moduleSelectionSection').style.display = 'block';
            currentSection = 'moduleSelection';
            errorElement.style.display = 'none';
        } else {
            errorElement.style.display = 'block';
            document.getElementById('accessCodeInput').focus();
        }
    });
}

// Show coma module
function startComaModule() {
    hideAllSections();
    document.getElementById('comaModuleSection').style.display = 'block';
    currentSection = 'comaModule';
    document.getElementById('gfapComaInput').focus();
}

// Show stroke prerequisite screen
function startStrokeModule() {
    hideAllSections();
    document.getElementById('strokePrerequisiteSection').style.display = 'block';
    currentSection = 'strokePrerequisite';
}

// Validate prerequisites
function validatePrerequisites() {
    const prerequisite1 = document.getElementById('prerequisite1').checked;
    const prerequisite2 = document.getElementById('prerequisite2').checked;
    const prerequisite3 = document.getElementById('prerequisite3').checked;
    const prerequisite4 = document.getElementById('prerequisite4').checked;
    const errorElement = document.getElementById('prerequisiteError');
    
    if (prerequisite1 && prerequisite2 && prerequisite3 && prerequisite4) {
        hideAllSections();
        document.getElementById('strokeModuleSection').style.display = 'block';
        currentSection = 'strokeModule';
        document.getElementById('ageInput').focus();
        errorElement.style.display = 'none';
    } else {
        errorElement.style.display = 'block';
        
        // Highlight unchecked boxes
        document.querySelectorAll('.checkbox-group').forEach(group => {
            const checkbox = group.querySelector('input[type="checkbox"]');
            if (!checkbox.checked) {
                group.style.borderColor = 'var(--danger-color)';
                setTimeout(() => {
                    group.style.borderColor = '#ddd';
                }, 2000);
            }
        });
    }
}

// Calculate coma risk
function calculateComaRisk(skipAnimation) {
    if (!skipAnimation) {
        // Get values
        const gfap = parseFloat(document.getElementById('gfapComaInput').value);
        const result = document.getElementById('comaResult');
        const spinner = document.getElementById('comaSpinner');
        
        // Validate input
        if (isNaN(gfap) || gfap < 29 || gfap > 10001) {
            result.innerText = translations[currentLang].invalidInput;
            result.className = 'result warning';
            result.style.display = 'block';
            return;
        }
        
        // Show spinner and disable input during calculation
        spinner.style.display = 'block';
        document.getElementById('gfapComaInput').disabled = true;
        document.querySelector('#comaModuleSection button').disabled = true;
        
        // Simulate loading delay
        setTimeout(() => {
            // Hide spinner and enable inputs
            spinner.style.display = 'none';
            document.getElementById('gfapComaInput').disabled = false;
            document.querySelector('#comaModuleSection button').disabled = false;
            
            // Calculate risk
            displayComaRiskResult(gfap);
        }, 800);
    } else {
        // Skip animation and just update result display for language change
        const gfap = parseFloat(document.getElementById('gfapComaInput').value);
        if (!isNaN(gfap) && gfap >= 29 && gfap <= 10001) {
            displayComaRiskResult(gfap);
        }
    }
}

// Display coma risk result
function displayComaRiskResult(gfap) {
    const result = document.getElementById('comaResult');
    
    // Calculate probability using the formula
    const y = 36.72 * Math.log10(gfap) - 50.48;
    const probability = Math.min(Math.max(y, 0), 100);
    
    // Determine risk level
    let riskLevel, riskClass, recommendation;
    
    if (gfap <= 100) {
        riskLevel = translations[currentLang].lowRisk;
        riskClass = 'low-risk';
        recommendation = recommendations[currentLang].lowRisk;
    } else if (gfap <= 1000) {
        riskLevel = translations[currentLang].mediumRisk;
        riskClass = 'medium-risk';
        recommendation = recommendations[currentLang].mediumRisk;
    } else {
        riskLevel = translations[currentLang].highRisk;
        riskClass = 'high-risk';
        recommendation = recommendations[currentLang].highRisk;
    }
    
    // Create risk gauge position (0-100%)
    const gaugePosition = Math.min(probability, 100);
    
    // Create result HTML with gauge and detailed information
    result.innerHTML = `
        <div>${riskLevel}</div>
        <div class="risk-gauge">
            <div class="risk-marker" style="left: ${gaugePosition}%;"></div>
        </div>
        <div class="result-details">
            <p><strong>${translations[currentLang].probabilityText}:</strong> ${probability.toFixed(1)}%</p>
            <p><strong>${translations[currentLang].recommendation}:</strong> ${recommendation}</p>
            <p><em>GFAP Value: ${gfap} pg/mL</em></p>
        </div>
    `;
    
    result.className = 'result ' + riskClass;
    result.style.display = 'block';
}

// Calculate stroke risk
function calculateStrokeRisk(skipAnimation) {
    if (!skipAnimation) {
        // Get values
        const age = parseInt(document.getElementById('ageInput').value);
        const gfap = parseFloat(document.getElementById('gfapStrokeInput').value);
        const result = document.getElementById('strokeResult');
        const spinner = document.getElementById('strokeSpinner');
        
        // Validate input
        if (isNaN(age) || isNaN(gfap) || age < 18 || age > 120 || gfap < 29 || gfap > 10001) {
            result.innerText = translations[currentLang].invalidInput;
            result.className = 'result warning';
            result.style.display = 'block';
            return;
        }
        
        // Show spinner and disable inputs during calculation
        spinner.style.display = 'block';
        document.getElementById('ageInput').disabled = true;
        document.getElementById('gfapStrokeInput').disabled = true;
        document.querySelector('#strokeModuleSection button').disabled = true;
        
        // Simulate loading delay
        setTimeout(() => {
            // Hide spinner and enable inputs
            spinner.style.display = 'none';
            document.getElementById('ageInput').disabled = false;
            document.getElementById('gfapStrokeInput').disabled = false;
            document.querySelector('#strokeModuleSection button').disabled = false;
            
            // Calculate risk
            displayStrokeRiskResult(age, gfap);
        }, 800);
    } else {
        // Skip animation and just update result display for language change
        const age = parseInt(document.getElementById('ageInput').value);
        const gfap = parseFloat(document.getElementById('gfapStrokeInput').value);
        if (!isNaN(age) && !isNaN(gfap) && age >= 18 && age <= 120 && gfap >= 29 && gfap <= 10001) {
            displayStrokeRiskResult(age, gfap);
        }
    }
}

// Display stroke risk result
function displayStrokeRiskResult(age, gfap) {
    const result = document.getElementById('strokeResult');
    
    // Determine risk category based on age and GFAP value
    let interpretation, riskClass, recommendation;
    
    if (age < 72) {
        if (gfap < 30) {
            interpretation = strokeInterpretations[currentLang].veryLow;
            riskClass = 'low-risk';
            recommendation = recommendations[currentLang].lowRisk;
        } else if (gfap <= 36.8) {
            interpretation = strokeInterpretations[currentLang].low;
            riskClass = 'low-risk';
            recommendation = recommendations[currentLang].lowRisk;
        } else if (gfap < 49.2) {
            interpretation = strokeInterpretations[currentLang].intermediate;
            riskClass = 'medium-risk';
            recommendation = recommendations[currentLang].mediumRisk;
        } else if (gfap < 54) {
            interpretation = strokeInterpretations[currentLang].high;
            riskClass = 'high-risk';
            recommendation = recommendations[currentLang].highRisk;
        } else {
            interpretation = strokeInterpretations[currentLang].veryHigh;
            riskClass = 'very-high-risk';
            recommendation = recommendations[currentLang].veryHighRisk;
        }
    } else if (age <= 83) {
        if (gfap < 30) {
            interpretation = strokeInterpretations[currentLang].veryLow;
            riskClass = 'low-risk';
            recommendation = recommendations[currentLang].lowRisk;
        } else if (gfap <= 36.8) {
            interpretation = strokeInterpretations[currentLang].low;
            riskClass = 'low-risk';
            recommendation = recommendations[currentLang].lowRisk;
        } else if (gfap < 107) {
            interpretation = strokeInterpretations[currentLang].intermediate;
            riskClass = 'medium-risk';
            recommendation = recommendations[currentLang].mediumRisk;
        } else if (gfap < 149.9) {
            interpretation = strokeInterpretations[currentLang].high;
            riskClass = 'high-risk';
            recommendation = recommendations[currentLang].highRisk;
        } else {
            interpretation = strokeInterpretations[currentLang].veryHigh;
            riskClass = 'very-high-risk';
            recommendation = recommendations[currentLang].veryHighRisk;
        }
    } else {
        if (gfap < 30) {
            interpretation = strokeInterpretations[currentLang].veryLow;
            riskClass = 'low-risk';
            recommendation = recommendations[currentLang].lowRisk;
        } else if (gfap <= 36.8) {
            interpretation = strokeInterpretations[currentLang].low;
            riskClass = 'low-risk';
            recommendation = recommendations[currentLang].lowRisk;
        } else if (gfap < 146.5) {
            interpretation = strokeInterpretations[currentLang].intermediate;
            riskClass = 'medium-risk';
            recommendation = recommendations[currentLang].mediumRisk;
        } else {
            interpretation = strokeInterpretations[currentLang].high;
            riskClass = 'high-risk';
            recommendation = recommendations[currentLang].highRisk;
        }
    }
    
    // Create result HTML with detailed information
    result.innerHTML = `
        <div>${interpretation}</div>
        <div class="result-details">
            <p><strong>${translations[currentLang].recommendation}:</strong> ${recommendation}</p>
            <p><em>Patient Age: ${age}, GFAP Value: ${gfap} pg/mL</em></p>
        </div>
    `;
    
    result.className = 'result ' + riskClass;
    result.style.display = 'block';
}

// Show modal with information
function showModal(title, content) {
    document.getElementById('modalTitle').innerText = title;
    document.getElementById('modalContent').innerText = content;
    document.getElementById('infoModal').style.display = 'block';
}

// Close modal
function closeModal() {
    document.getElementById('infoModal').style.display = 'none';
}

// Simulate loading for better UX
function simulateLoading(callback) {
    setTimeout(() => {
        if (callback && typeof callback === 'function') {
            callback();
        }
    }, 600);
}

// Handle Enter key press
document.addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        if (currentSection === 'codeEntry') {
            validateAccessCode();
        } else if (currentSection === 'comaModule') {
            calculateComaRisk();
        } else if (currentSection === 'strokeModule') {
            calculateStrokeRisk();
        }
    }
});

// Initialize app
window.onload = function() {
    document.getElementById('currentYear').innerText = new Date().getFullYear();
    
    // Set up access screen
    hideAllSections();
    document.getElementById('codeEntrySection').style.display = 'block';
    
    // Set default language
    switchLanguage('en');
    
    // Focus on input field
    document.getElementById('accessCodeInput').focus();
};

// Add service worker for PWA support
if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
        navigator.serviceWorker.register('/service-worker.js')
            .then(reg => console.log('Service Worker registered'))
            .catch(err => console.log('Service Worker registration failed: ', err));
    });
}
