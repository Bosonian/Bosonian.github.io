<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="iGFAP Check - Web App for calculating risk of intracranial hemorrhage based on GFAP values">
  <title>iGFAP Check</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#007bff">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    :root {
      --primary-color: #007bff;
      --primary-hover: #0056b3;
      --secondary-color: #dc3545;
      --secondary-hover: #b52b3a;
      --background-color: #f8f9fa;
      --text-color: #333;
    }
    body.dark-mode {
      --primary-color: #3399ff;
      --primary-hover: #287ac7;
      --secondary-color: #e06666;
      --secondary-hover: #cc5252;
      --background-color: #333;
      --text-color: #f8f9fa;
    }
    body {
      font-family: 'Arial', sans-serif;
      margin: 0;
      padding: 0;
      background-color: var(--background-color);
      color: var(--text-color);
    }
    .container {
      max-width: 500px;
      margin: 70px auto 20px auto;
      padding: 20px;
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    body.dark-mode .container {
      background-color: #444;
      color: var(--text-color);
    }
    .input-group, .checkbox-group {
      margin-bottom: 15px;
      text-align: left;
    }
    .input-group label, .checkbox-group label {
      margin-bottom: 5px;
    }
    .checkbox-group {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }
    .input-group input {
      width: calc(100% - 24px);
      padding: 12px;
      font-size: 18px;
      border: 2px solid var(--primary-color);
      border-radius: 5px;
    }
    button {
      padding: 12px;
      margin-top: 15px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.3s ease;
      width: 100%;
    }
    .primary {
      background-color: var(--primary-color);
      color: white;
    }
    .primary:hover {
      background-color: var(--primary-hover);
    }
    .secondary {
      background-color: var(--secondary-color);
      color: white;
    }
    .secondary:hover {
      background-color: var(--secondary-hover);
    }
    .result {
      margin-top: 1.5rem;
      padding: 1rem;
      border-radius: 8px;
      font-size: 18px;
      font-weight: bold;
      display: none;
      text-align: center;
    }
    .low-risk { color: #28a745; }
    .medium-risk { color: #daa520; }
    .red-risk { color: #dc3545; }
    .app-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      background-color: var(--primary-color);
      color: white;
      position: sticky;
      top: 0;
      z-index: 999;
    }
    .modal {
      display: none;
      position: fixed;
      z-index: 9999;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.6);
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    .modal.show { opacity: 1; }
    .modal-content {
      background-color: #fff;
      margin: 20% auto;
      padding: 20px;
      width: 80%;
      max-width: 400px;
      border-radius: 10px;
      text-align: center;
    }
    body.dark-mode .modal-content {
      background-color: #444;
      border: 1px solid #555;
    }
  </style>
</head>
<body>
  <header class="app-header">
    <div class="header-left">
      <h1 id="appTitle">iGFAP Check</h1>
    </div>
    <div class="header-right">
      <div class="language-switcher">
        <button onclick="switchLanguage('en')" aria-label="Switch to English">
          <img src="https://flagcdn.com/gb.svg" alt="English">
        </button>
        <button onclick="switchLanguage('de')" aria-label="Auf Deutsch umstellen">
          <img src="https://flagcdn.com/de.svg" alt="Deutsch">
        </button>
      </div>
      <button id="darkModeToggle" aria-label="Toggle Dark Mode">üåô</button>
      <button class="home-button" onclick="restartApp()" aria-label="Home">üè† Home</button>
    </div>
  </header>

  <!-- Access Code Screen -->
  <section id="codeEntrySection" class="container">
    <p id="codePrompt">üîë Please enter your access code:</p>
    <input type="password" id="accessCodeInput" placeholder="Enter code">
    <button class="primary" id="accessCodeButton">Submit</button>
    <p id="accessError" class="warning" style="display:none;"></p>
  </section>

  <!-- Module Selection Screen -->
  <section id="moduleSelectionSection" class="container" style="display:none;">
    <h2 id="moduleSelectionTitle">Check probability for:</h2>
    <button class="primary" id="comaModuleButton"></button>
    <button class="primary" id="strokeModuleButton"></button>
  </section>

  <!-- Coma Module Screen -->
  <section id="comaModuleSection" class="container" style="display:none;">
    <h2 id="comaModuleTitle">Intracranial hemorrhage in comatose patients (GCS 3-8)</h2>
    <div class="input-group">
      <label for="gfapComaInput" id="gfapComaLabel">GFAP Value (pg/mL)</label>
      <input type="number" id="gfapComaInput" min="29" max="10001" placeholder="GFAP Value (pg/mL)">
    </div>
    <button class="primary" id="calculateComaButton">Calculate Probability</button>
    <button class="secondary" onclick="restartApp()">‚¨ÖÔ∏è Back</button>
    <div class="result" id="comaResult"></div>
  </section>

  <!-- Stroke Prerequisite Screen -->
  <section id="strokePrerequisiteSection" class="container" style="display:none;">
    <h2 id="strokePrerequisiteTitle">Prerequisites for Stroke Risk Calculation</h2>
    <div class="checkbox-group">
      <input type="checkbox" id="prerequisite1">
      <label for="prerequisite1" id="prerequisite1Label"></label>
    </div>
    <div class="checkbox-group">
      <input type="checkbox" id="prerequisite2">
      <label for="prerequisite2" id="prerequisite2Label"></label>
    </div>
    <div class="checkbox-group">
      <input type="checkbox" id="prerequisite3">
      <label for="prerequisite3" id="prerequisite3Label"></label>
    </div>
    <div class="checkbox-group">
      <input type="checkbox" id="prerequisite4">
      <label for="prerequisite4" id="prerequisite4Label"></label>
    </div>
    <button class="primary" id="proceedButton">Proceed to Calculation</button>
    <button class="secondary" onclick="restartApp()">‚¨ÖÔ∏è Back</button>
    <p id="prerequisiteError"></p>
  </section>

  <!-- Stroke Module Screen -->
  <section id="strokeModuleSection" class="container" style="display:none;">
    <h2 id="strokeModuleTitle">Intracerebral hemorrhage in patients with stroke symptoms</h2>
    <div class="input-group">
      <label for="ageInput" id="ageLabel">Patient Age (Years)</label>
      <input type="number" id="ageInput" min="18" max="120" placeholder="Patient Age (Years)">
    </div>
    <div class="input-group">
      <label for="gfapStrokeInput" id="gfapStrokeLabel">GFAP Value (pg/mL)</label>
      <input type="number" id="gfapStrokeInput" min="29" max="10001" placeholder="GFAP Value (pg/mL)">
    </div>
    <div class="input-group">
      <label for="sbpInput" id="sbpLabel">Systolic BP (mmHg)</label>
      <input type="number" id="sbpInput" min="50" max="250" placeholder="Systolic BP (mmHg)">
    </div>
    <button class="primary" id="calculateStrokeButton">Calculate Probability</button>
    <button class="secondary" onclick="restartApp()">‚¨ÖÔ∏è Back</button>
    <div class="result" id="strokeResult"></div>
  </section>

  <footer style="text-align:center; margin-top:20px;">
    <p>¬© <span id="currentYear"></span> iGFAP. All rights reserved.</p>
  </footer>

  <!-- Modals -->
  <div id="disclaimerModal" class="modal">
    <div class="modal-content">
      <p id="disclaimerText"></p>
      <button class="primary" id="disclaimerConfirmButton">Confirm</button>
    </div>
  </div>

  <script>
    let currentLang = 'en';
    let deferredPrompt = null;
    let pendingResult = null;

    const translations = {
      en: {
        appTitle: "iGFAP Check",
        codePrompt: "üîë Please enter your access code:",
        moduleSelectionTitle: "Check probability for:",
        comaModuleTitle: "Intracranial hemorrhage in comatose patients (GCS 3-8)",
        strokeModuleTitle: "Intracerebral hemorrhage in patients with stroke symptoms",
        strokePrerequisiteTitle: "Prerequisites for Stroke Risk Calculation",
        accessError: "Incorrect code. Please try again.",
        calculateButton: "Calculate Probability",
        proceedButton: "Proceed to Calculation",
        rangeError: "Please enter a value between 29 and 10001 pg/mL.",
        invalidInput: "Please enter a valid value!",
        lowRisk: "Low Risk",
        mediumRisk: "Medium Risk",
        highRisk: "High Risk",
        disclaimer: "The calculations are for research purposes only, do not make clinical decisions based on it.",
        probability: "Probability",
        riskLevel: "Risk Level",
        gfapLabel: "GFAP Value (pg/mL)",
        ageLabel: "Patient Age (Years)",
        sbpLabel: "Systolic BP (mmHg)",
        sbpError: "Valid SBP range: 50-250 mmHg",
        invalidAge: "Please enter valid age (18-120)",
        invalidGFAP: "Invalid GFAP value",
        prerequisite1: "Confirmed time window < 6 hours",
        prerequisite2: "No neurological deficits before the event",
        prerequisite3: "No identifiable head trauma (severe fall)",
        prerequisite4: "FAST ED Score >= 3 points"
      },
      de: {
        appTitle: "iGFAP Check",
        codePrompt: "üîë Bitte geben Sie Ihren Zugangscode ein:",
        moduleSelectionTitle: "Wahrscheinlichkeit pr√ºfen f√ºr:",
        comaModuleTitle: "Intrakranielle Blutungen bei komat√∂sen Patienten (GCS 3-8)",
        strokeModuleTitle: "Intracerebrale Blutungen bei Patienten mit Schlaganfallsymptomen",
        strokePrerequisiteTitle: "Voraussetzungen f√ºr die Schlaganfallrisikoberechnung",
        accessError: "Falscher Code. Bitte versuchen Sie es erneut.",
        calculateButton: "Wahrscheinlichkeit berechnen",
        proceedButton: "Zur Berechnung fortfahren",
        rangeError: "Bitte geben Sie einen Wert zwischen 29 und 10001 pg/mL ein.",
        invalidInput: "Bitte geben Sie einen g√ºltigen Wert ein!",
        lowRisk: "Geringes Risiko",
        mediumRisk: "Mittleres Risiko",
        highRisk: "Hohes Risiko",
        disclaimer: "Die Berechnungen dienen nur Forschungszwecken, treffen Sie keine klinischen Entscheidungen basierend darauf.",
        probability: "Wahrscheinlichkeit",
        riskLevel: "Risikostufe",
        gfapLabel: "GFAP-Wert (pg/mL)",
        ageLabel: "Patientenalter (Jahre)",
        sbpLabel: "Systolischer RR (mmHg)",
        sbpError: "G√ºltiger RR-Bereich: 50-250 mmHg",
        invalidAge: "Bitte g√ºltiges Alter eingeben (18-120)",
        invalidGFAP: "Ung√ºltiger GFAP-Wert",
        prerequisite1: "Gesichertes Zeitfenster < 6 Stunden",
        prerequisite2: "Keine neurologischen Defizite vor dem Ereignis",
        prerequisite3: "Kein erkennbares Sch√§del-Hirn-Trauma (schwerer Sturz)",
        prerequisite4: "FAST ED Score >= 3 Punkte"
      }
    };

    // Rest of JavaScript remains same as previous version with updated calculateStrokeRisk()
    // ... [Include all JavaScript functions from previous answer here] ...
  </script>
</body>
</html>