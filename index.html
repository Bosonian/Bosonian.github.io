<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>GFAP Risk Check</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet"/>

  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" crossorigin="anonymous" />

  <style>
    :root {
      --primary-color: #007bff;
      --primary-hover: #0056b3;
      --danger-color: #dc3545;
      --danger-hover: #b52b3a;
      --success-color: #28a745;
      --background-color: #f9f9f9;
      --text-color: #333;
    }

    body {
      font-family: 'Roboto', sans-serif;
      background-color: var(--background-color);
      margin: 0;
      padding: 0;
      color: var(--text-color);
    }

    .container {
      max-width: 400px;
      margin: 60px auto;
      padding: 30px 20px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
      transition: all 0.3s ease;
    }

    h1 {
      font-size: 1.8rem;
      color: var(--primary-color);
      margin-bottom: 1rem;
    }

    .button-group, .language-buttons {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 20px;
    }

    button {
      flex: 1;
      padding: 12px;
      font-size: 14px;
      font-weight: 500;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s, transform 0.2s;
    }

    button.primary {
      background-color: var(--primary-color);
      color: white;
    }

    button.primary:hover {
      background-color: var(--primary-hover);
      transform: translateY(-2px);
    }

    button.secondary {
      background-color: var(--danger-color);
      color: white;
    }

    button.secondary:hover {
      background-color: var(--danger-hover);
      transform: translateY(-2px);
    }

    input[type="text"], input[type="number"] {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      border: 1px solid #ddd;
      border-radius: 6px;
      margin-top: 8px;
      margin-bottom: 15px;
      transition: border-color 0.3s;
    }

    input[type="text"]:focus, input[type="number"]:focus {
      border-color: var(--primary-color);
      outline: none;
    }

    p {
      margin-bottom: 0.5rem;
      font-weight: 500;
    }

    .checkbox-group {
      text-align: left;
      margin-bottom: 15px;
    }

    .checkbox-group label {
      display: flex;
      align-items: center;
      font-weight: 400;
      margin-bottom: 10px;
    }

    .checkbox-group input {
      margin-right: 10px;
    }

    .result {
      display: none;
      padding: 16px;
      border-radius: 8px;
      font-weight: bold;
      text-align: center;
      margin-top: 20px;
    }

    .low-risk { background: #e6f4ea; color: var(--success-color); }
    .medium-risk { background: #fff4e5; color: #ff9800; }
    .high-risk { background: #fdecea; color: var(--danger-color); }

    footer {
      text-align: center;
      margin-top: 40px;
      font-size: 12px;
      color: #aaa;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>üß† GFAP Risk Check</h1>

    <!-- Language Buttons -->
    <div class="language-buttons">
      <button onclick="switchLanguage('de')">üá©üá™ Deutsch</button>
      <button onclick="switchLanguage('en')">üá¨üáß English</button>
    </div>

    <!-- Access Code Section -->
    <div id="codeEntrySection">
      <p id="codePrompt">üîë Please enter your access code:</p>
      <input type="text" id="accessCodeInput" placeholder="Enter code">
      <button class="primary" onclick="validateAccessCode()">Confirm</button>
      <p id="accessError" style="color: var(--danger-color); display: none;">‚ùå Invalid access code!</p>
    </div>

    <!-- Module Selection -->
    <div id="moduleSelection" style="display: none;">
      <p id="modulePrompt">Select the relevant module:</p>
      <div class="button-group">
        <button class="primary" onclick="selectModule('coma')">Coma (GCS 3-8)</button>
        <button class="primary" onclick="selectModule('stroke')">Stroke</button>
      </div>
    </div>

    <!-- Stroke Checks -->
    <div id="strokeChecks" style="display: none;">
      <p id="strokeCheckPrompt">Please confirm the following for the stroke patient:</p>
      <div class="checkbox-group">
        <label><input type="checkbox" id="timeWindowCheck"> Stroke within 6 hours</label>
        <label><input type="checkbox" id="symptomHistoryCheck"> No prior stroke-like symptoms</label>
        <label><input type="checkbox" id="traumaCheck"> No significant head trauma</label>
        <label><input type="checkbox" id="fastEdScoreCheck"> FAST-ED score ‚â• 3</label>
      </div>
      <button class="primary" onclick="proceedToStrokeInput()">Proceed</button>
    </div>

    <!-- Calculator -->
    <div id="calculatorSection" style="display: none;">
      <p id="description">Enter the measured GFAP value (pg/mL):</p>
      <input type="number" id="gfapInput" placeholder="GFAP value" min="29" max="10000">
      <input type="number" id="ageInput" placeholder="Age" min="1" max="120" style="display: none;">
      <div class="button-group">
        <button class="primary" onclick="calculateRisk()">Calculate</button>
        <button class="secondary" onclick="resetForm()">Reset</button>
      </div>
      <div class="result" id="result"></div>
    </div>
  </div>

  <footer>
    <p>¬© 2025 iGFAP. All rights reserved.</p>
  </footer>

  <script>
    const VALID_CODES = ['1234', 'test2025', 'gfap2024'];

    const texts = {
      en: {
        codePrompt: 'üîë Please enter your access code:',
        accessError: '‚ùå Invalid access code!',
        modulePrompt: 'Select the relevant module:',
        strokeCheckPrompt: 'Please confirm the following for the stroke patient:',
        description: 'Enter the measured GFAP value (pg/mL):',
        validationError: '‚ùå Please enter a valid GFAP value between 29 and 10000!',
        alert: 'Do you want to proceed with the calculation?',
        probabilityLabel: 'Probability'
      },
      de: {
        codePrompt: 'üîë Bitte Zugangscode eingeben:',
        accessError: '‚ùå Ung√ºltiger Zugangscode!',
        modulePrompt: 'W√§hle das relevante Modul:',
        strokeCheckPrompt: 'Bitte best√§tigen Sie folgendes f√ºr den Schlaganfallpatienten:',
        description: 'Geben Sie den gemessenen GFAP-Wert (pg/mL) ein:',
        validationError: '‚ùå Bitte einen g√ºltigen GFAP-Wert zwischen 29 und 10000 eingeben!',
        alert: 'M√∂chten Sie mit der Berechnung fortfahren?',
        probabilityLabel: 'Wahrscheinlichkeit'
      }
    };

    let currentLang = 'en';

    window.onload = () => {
      if (sessionStorage.getItem('accessGranted') === 'true') {
        document.getElementById('codeEntrySection').style.display = 'none';
        document.getElementById('moduleSelection').style.display = 'block';
      }
      if (sessionStorage.getItem('lang')) {
        switchLanguage(sessionStorage.getItem('lang'));
      }
    };

    function switchLanguage(lang) {
      currentLang = lang;
      sessionStorage.setItem('lang', lang);
      document.getElementById('codePrompt').innerText = texts[lang].codePrompt;
      document.getElementById('accessError').innerText = texts[lang].accessError;
      document.getElementById('modulePrompt').innerText = texts[lang].modulePrompt;
      document.getElementById('strokeCheckPrompt').innerText = texts[lang].strokeCheckPrompt;
      document.getElementById('description').innerText = texts[lang].description;
    }

    function validateAccessCode() {
      const enteredCode = document.getElementById('accessCodeInput').value.trim();
      const errorMsg = document.getElementById('accessError');

      if (VALID_CODES.includes(enteredCode)) {
        document.getElementById('codeEntrySection').style.display = 'none';
        document.getElementById('moduleSelection').style.display = 'block';
        errorMsg.style.display = 'none';
        sessionStorage.setItem('accessGranted', 'true');
      } else {
        errorMsg.style.display = 'block';
      }
    }

    function selectModule(module) {
      document.getElementById('moduleSelection').style.display = 'none';

      if (module === 'coma') {
        document.getElementById('calculatorSection').style.display = 'block';
        document.getElementById('ageInput').style.display = 'none';
      } else if (module === 'stroke') {
        document.getElementById('strokeChecks').style.display = 'block';
      }
    }

    function proceedToStrokeInput() {
      if (
        document.getElementById('timeWindowCheck').checked &&
        document.getElementById('symptomHistoryCheck').checked &&
        document.getElementById('traumaCheck').checked &&
        document.getElementById('fastEdScoreCheck').checked
      ) {
        document.getElementById('strokeChecks').style.display = 'none';
        document.getElementById('calculatorSection').style.display = 'block';
        document.getElementById('ageInput').style.display = 'block';
      } else {
        alert(currentLang === 'de'
          ? 'Bitte best√§tigen Sie alle Bedingungen f√ºr den Schlaganfallpatienten.'
          : 'Please confirm all the conditions for the stroke patient.');
      }
    }

    function calculateRisk() {
      const gfapInput = parseFloat(document.getElementById('gfapInput').value);
      const ageInputField = document.getElementById('ageInput');
      const resDiv = document.getElementById('result');

      if (isNaN(gfapInput) || gfapInput < 29 || gfapInput > 10000) {
        resDiv.innerHTML = texts[currentLang].validationError;
        resDiv.className = 'result high-risk';
        resDiv.style.display = "block";
        return;
      }

      if (!confirm(texts[currentLang].alert)) return;

      let riskLevel = '';
      let riskText = '';
      let probability = 0;

      if (ageInputField.style.display === 'block') {
        const ageInput = parseFloat(ageInputField.value);
        if (isNaN(ageInput)) {
          resDiv.innerHTML = currentLang === 'de' ? '‚ùå Bitte Alter eingeben!' : '‚ùå Please enter age!';
          resDiv.style.display = "block";
          return;
        }

        if (gfapInput < 30) {
          riskLevel = 'low-risk';
          riskText = currentLang === 'de' ? 'Hohe Wahrscheinlichkeit f√ºr Hirninfarkt' : 'High probability of cerebral infarction';
          probability = 10;
        } else if (ageInput < 72) {
          riskLevel = gfapInput > 54 ? 'high-risk' : 'medium-risk';
          riskText = currentLang === 'de' ? (riskLevel === 'high-risk' ? 'Sehr hohes Risiko' : 'Mittleres Risiko') : (riskLevel === 'high-risk' ? 'Very High Risk' : 'Medium Risk');
          probability = riskLevel === 'high-risk' ? 91 : 50;
        } else {
          riskLevel = gfapInput > 149.9 ? 'high-risk' : 'medium-risk';
          riskText = currentLang === 'de' ? (riskLevel === 'high-risk' ? 'Sehr hohes Risiko' : 'Mittleres Risiko') : (riskLevel === 'high-risk' ? 'Very High Risk' : 'Medium Risk');
          probability = riskLevel === 'high-risk' ? 90 : 60;
        }

      } else {
        riskLevel = gfapInput > 50 ? 'high-risk' : 'low-risk';
        riskText = currentLang === 'de' ? (riskLevel === 'high-risk' ? 'Hohes Risiko f√ºr intrakranielle Blutung' : 'Niedriges Risiko') : (riskLevel === 'high-risk' ? 'High risk of intracranial bleeding' : 'Low risk');
        probability = riskLevel === 'high-risk' ? 85 : 10;
      }

      resDiv.innerHTML = `<strong>${riskText}</strong><br>${texts[currentLang].probabilityLabel}: ${probability}%`;
      resDiv.className = `result ${riskLevel}`;
      resDiv.style.display = "block";
    }

    function resetForm() {
      document.getElementById('gfapInput').value = '';
      document.getElementById('ageInput').value = '';
      document.getElementById('result').style.display = 'none';
      document.getElementById('calculatorSection').style.display = 'none';
      document.getElementById('moduleSelection').style.display = 'block';
      document.querySelectorAll('#strokeChecks input[type=checkbox]').forEach(cb => cb.checked = false);
    }

  </script>
</body>
</html>